# Дипломный практикум в Yandex.Cloud


---
## Цели:

1. Подготовить облачную инфраструктуру на базе облачного провайдера Яндекс.Облако.
2. Запустить и сконфигурировать Kubernetes кластер.
3. Установить и настроить систему мониторинга.
4. Настроить и автоматизировать сборку тестового приложения с использованием Docker-контейнеров.
5. Настроить CI для автоматической сборки и тестирования.
6. Настроить CD для автоматического развёртывания приложения.

---
## Этапы выполнения:


### Создание облачной инфраструктуры

Предварительная подготовка к установке и запуску Kubernetes кластера.

Подготовка инфраструктуры с использованием terraform ([конфигурационные файлы](terraform))   
Для удобства создан файл [deploy.sh](deploy.sh) - создаёт сервисный аккаунт, бакет, бэкэнд и запускает создание инфраструктуры
![img.png](img/infra.png)
---
### Создание Kubernetes кластера

#### Установка Kubernetes кластера на ВМ.  
   Для установки кластера будет использован [Kubespray](https://kubernetes.io/docs/setup/production-environment/tools/kubespray/).  
   Подготовлены конфигурации [ansible](ansible)  
   Задеплоен кластер. По инструкции настроен доступ 
![img.png](img/k8s_cluster.png)
  

---
### Создание тестового приложения

   а. Создан отдельный git репозиторий с простым nginx конфигом https://github.com/Hovard777/diplom-app.  
   б. Подготовлен Dockerfile для создания образа приложения. 
   в. Образ отправлен в https://hub.docker.com/  
![img.png](img/dockerhub.png)


---
### Подготовка cистемы мониторинга и деплой приложения

Задеплоил систему мониторинга, используя пакет kube-prometheus
![img.png](img/grafana.png)
Используя манифест [app.yaml](app%2Fapp.yaml), задеплоил приложение.
![img.png](img/app.png)


---
### Установка и настройка CI/CD

Осталось настроить ci/cd систему для автоматической сборки docker image и деплоя приложения при изменении кода.

Цель:

1. Автоматическая сборка docker образа при коммите в репозиторий с тестовым приложением.
2. Автоматический деплой нового docker образа.

Можно использовать [teamcity](https://www.jetbrains.com/ru-ru/teamcity/), [jenkins](https://www.jenkins.io/), [GitLab CI](https://about.gitlab.com/stages-devops-lifecycle/continuous-integration/) или GitHub Actions.

Ожидаемый результат:

1. Интерфейс ci/cd сервиса доступен по http.
2. При любом коммите в репозиторие с тестовым приложением происходит сборка и отправка в регистр Docker образа.
3. При создании тега (например, v1.0.0) происходит сборка и отправка с соответствующим label в регистри, а также деплой соответствующего Docker образа в кластер Kubernetes.

---
## Что необходимо для сдачи задания?

1. Репозиторий с конфигурационными файлами Terraform и готовность продемонстрировать создание всех ресурсов с нуля.
2. Пример pull request с комментариями созданными atlantis'ом или снимки экрана из Terraform Cloud или вашего CI-CD-terraform pipeline.
3. Репозиторий с конфигурацией ansible, если был выбран способ создания Kubernetes кластера при помощи ansible.
4. Репозиторий с Dockerfile тестового приложения и ссылка на собранный docker image.
5. Репозиторий с конфигурацией Kubernetes кластера.
6. Ссылка на тестовое приложение и веб интерфейс Grafana с данными доступа.
7. Все репозитории рекомендуется хранить на одном ресурсе (github, gitlab)

